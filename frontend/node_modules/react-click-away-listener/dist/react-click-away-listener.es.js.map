{"version":3,"file":"react-click-away-listener.es.js","sources":["../src/index.tsx"],"sourcesContent":["import React, {\n\tuseRef,\n\tuseEffect,\n\tRefCallback,\n\tcloneElement,\n\tReactElement,\n\tHTMLAttributes,\n\tMutableRefObject,\n\tFunctionComponent\n} from 'react';\n\ntype FocusEvents = 'focusin' | 'focusout';\ntype MouseEvents = 'click' | 'mousedown' | 'mouseup';\ntype TouchEvents = 'touchstart' | 'touchend';\ntype Events = FocusEvent | MouseEvent | TouchEvent;\n\ninterface Props extends HTMLAttributes<HTMLElement> {\n\tonClickAway: (event: Events) => void;\n\tfocusEvent?: FocusEvents;\n\tmouseEvent?: MouseEvents;\n\ttouchEvent?: TouchEvents;\n\tchildren: ReactElement<any>;\n}\n\nconst eventTypeMapping = {\n\tclick: 'onClick',\n\tfocusin: 'onFocus',\n\tfocusout: 'onFocus',\n\tmousedown: 'onMouseDown',\n\tmouseup: 'onMouseUp',\n\ttouchstart: 'onTouchStart',\n\ttouchend: 'onTouchEnd'\n};\n\nconst ClickAwayListener: FunctionComponent<Props> = ({\n\tchildren,\n\tonClickAway,\n\tfocusEvent = 'focusin',\n\tmouseEvent = 'click',\n\ttouchEvent = 'touchend'\n}) => {\n\tconst node = useRef<HTMLElement | null>(null);\n\tconst bubbledEventTarget = useRef<EventTarget | null>(null);\n\tconst mountedRef = useRef(false);\n\n\t/**\n\t * Prevents the bubbled event from getting triggered immediately\n\t * https://github.com/facebook/react/issues/20074\n\t */\n\tuseEffect(() => {\n\t\tsetTimeout(() => {\n\t\t\tmountedRef.current = true;\n\t\t}, 0);\n\n\t\treturn () => {\n\t\t\tmountedRef.current = false;\n\t\t};\n\t}, []);\n\n\tconst handleBubbledEvents =\n\t\t(type: string) =>\n\t\t(event: Events): void => {\n\t\t\tbubbledEventTarget.current = event.target;\n\n\t\t\tconst handler = children?.props[type];\n\n\t\t\tif (handler) {\n\t\t\t\thandler(event);\n\t\t\t}\n\t\t};\n\n\tconst handleChildRef = (childRef: HTMLElement) => {\n\t\tnode.current = childRef;\n\n\t\tlet { ref } = children as typeof children & {\n\t\t\tref: RefCallback<HTMLElement> | MutableRefObject<HTMLElement>;\n\t\t};\n\n\t\tif (typeof ref === 'function') {\n\t\t\tref(childRef);\n\t\t} else if (ref) {\n\t\t\tref.current = childRef;\n\t\t}\n\t};\n\n\tuseEffect(() => {\n\t\tconst nodeDocument = node.current?.ownerDocument ?? document;\n\n\t\tconst handleEvents = (event: Events): void => {\n\t\t\tif (!mountedRef.current) return;\n\n\t\t\tif (\n\t\t\t\t(node.current && node.current.contains(event.target as Node)) ||\n\t\t\t\tbubbledEventTarget.current === event.target ||\n\t\t\t\t!nodeDocument.contains(event.target as Node)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tonClickAway(event);\n\t\t};\n\n\t\tnodeDocument.addEventListener(mouseEvent, handleEvents);\n\t\tnodeDocument.addEventListener(touchEvent, handleEvents);\n\t\tnodeDocument.addEventListener(focusEvent, handleEvents);\n\n\t\treturn () => {\n\t\t\tnodeDocument.removeEventListener(mouseEvent, handleEvents);\n\t\t\tnodeDocument.removeEventListener(touchEvent, handleEvents);\n\t\t\tnodeDocument.removeEventListener(focusEvent, handleEvents);\n\t\t};\n\t}, [focusEvent, mouseEvent, onClickAway, touchEvent]);\n\n\tconst mappedMouseEvent = eventTypeMapping[mouseEvent];\n\tconst mappedTouchEvent = eventTypeMapping[touchEvent];\n\tconst mappedFocusEvent = eventTypeMapping[focusEvent];\n\n\treturn React.Children.only(\n\t\tcloneElement(children as ReactElement<any>, {\n\t\t\tref: handleChildRef,\n\t\t\t[mappedFocusEvent]: handleBubbledEvents(mappedFocusEvent),\n\t\t\t[mappedMouseEvent]: handleBubbledEvents(mappedMouseEvent),\n\t\t\t[mappedTouchEvent]: handleBubbledEvents(mappedTouchEvent)\n\t\t})\n\t);\n};\n\nClickAwayListener.displayName = 'ClickAwayListener';\n\nexport default ClickAwayListener;\n"],"names":["eventTypeMapping","click","focusin","focusout","mousedown","mouseup","touchstart","touchend","ClickAwayListener","_ref","_cloneElement","children","onClickAway","_ref$focusEvent","focusEvent","_ref$mouseEvent","mouseEvent","_ref$touchEvent","touchEvent","node","useRef","bubbledEventTarget","mountedRef","useEffect","setTimeout","current","handleBubbledEvents","type","event","target","handler","props","_node$current$ownerDo","_node$current","nodeDocument","ownerDocument","document","handleEvents","contains","addEventListener","removeEventListener","mappedMouseEvent","mappedTouchEvent","mappedFocusEvent","React","Children","only","cloneElement","ref","childRef","_defineProperty","displayName"],"mappings":"2LAwBA,IAAMA,EAAmB,CACxBC,MAAO,UACPC,QAAS,UACTC,SAAU,UACVC,UAAW,cACXC,QAAS,YACTC,WAAY,eACZC,SAAU,cAGLC,EAA8C,SAM9CC,GAAA,IAAAC,EALLC,IAAAA,SACAC,IAAAA,YAIKC,EAAAJ,EAHLK,WAAAA,aAAa,UAGRD,EAAAE,EAAAN,EAFLO,WAAAA,aAAa,QAERD,EAAAE,EAAAR,EADLS,WAAAA,aAAa,WACRD,EACCE,EAAOC,EAA2B,MAClCC,EAAqBD,EAA2B,MAChDE,EAAaF,GAAO,GAM1BG,GAAU,WAKT,OAJAC,YAAW,WACVF,EAAWG,SAAU,CADZ,GAEP,GAEI,WACNH,EAAWG,SAAU,CACrB,CAPO,GAQN,IAEH,IAAMC,EACL,SAACC,GACD,OAAA,SAACC,GACAP,EAAmBI,QAAUG,EAAMC,OAE7BC,IAAAA,EAAUnB,aAAAA,EAAAA,EAAUoB,MAAMJ,GAE5BG,GACHA,EAAQF,EAET,CATD,EAyBDL,GAAU,WAAM,IAAAS,EAAAC,EACTC,EAAY,UAAG,UAAAf,EAAKM,eAAL,IAAAQ,OAAA,EAAAA,EAAcE,qBAAjB,IAAAH,EAAAA,EAAkCI,SAE9CC,EAAe,SAACT,GAChBN,EAAWG,UAGdN,EAAKM,SAAWN,EAAKM,QAAQa,SAASV,EAAMC,SAC7CR,EAAmBI,UAAYG,EAAMC,SACpCK,EAAaI,SAASV,EAAMC,SAK9BjB,EAAYgB,GACZ,EAMD,OAJAM,EAAaK,iBAAiBvB,EAAYqB,GAC1CH,EAAaK,iBAAiBrB,EAAYmB,GAC1CH,EAAaK,iBAAiBzB,EAAYuB,GAEnC,WACNH,EAAaM,oBAAoBxB,EAAYqB,GAC7CH,EAAaM,oBAAoBtB,EAAYmB,GAC7CH,EAAaM,oBAAoB1B,EAAYuB,EAC7C,CAzBO,GA0BN,CAACvB,EAAYE,EAAYJ,EAAaM,IAEzC,IAAMuB,EAAmBzC,EAAiBgB,GACpC0B,EAAmB1C,EAAiBkB,GACpCyB,EAAmB3C,EAAiBc,GAEnC8B,OAAAA,EAAMC,SAASC,KACrBC,EAAapC,GAEXgC,EAFUjC,EAAA,CACXsC,IAhDqB,SAACC,GACvB9B,EAAKM,QAAUwB,EAEf,IAAMD,EAAQrC,EAARqC,IAIa,mBAARA,EACVA,EAAIC,GACMD,IACVA,EAAIvB,QAAUwB,EAEf,GAqCEN,EAAmBjB,EAAoBiB,IAF7BO,EAAAxC,EAGV+B,EAAmBf,EAAoBe,QACvCC,EAAmBhB,EAAoBgB,IAJ7BhC,IAOb,EAEDF,EAAkB2C,YAAc"}